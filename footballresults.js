// Generated by CoffeeScript 1.10.0
var clubs, footballApiKey;

clubs = {
  atm: 78,
  ars: 57,
  rma: 86,
  liv: 64,
  fcb: 81,
  manc: 65
};

footballApiKey = process.env.HUBOT_FOOTBALL_ACCOUNT_KEY;

if (!footballApiKey) {
  throw "You must enter your HUBOT_FOOTBALL_ACCOUNT_KEY in your environment variables";
}

module.exports = function(robot) {
  return robot.respond(/get me result (.*)/i, function(msg) {
    var team, url;
    team = escape(msg.match[1]);
    url = 'http://api.football-data.org/alpha/teams/' + clubs[team] + '/fixtures';
    return msg.http(url).headers({
      'X-Auth-Token': footballApiKey,
      Accept: 'application/json'
    }).get()(function(err, res, body) {
      var first, json, key, last, value;
      json = JSON.parse(body);
      first = json.fixtures;
      last = json.fixtures[0];
      for (key in first) {
        value = first[key];
        if (value.status === 'TIMED') {
          break;
        } else {
          last = value;
        }
      }
      return msg.send(last.homeTeamName + ' ' + last.result.goalsHomeTeam + ' - ' + last.result.goalsAwayTeam + ' ' + last.awayTeamName);
    });
  });
};
